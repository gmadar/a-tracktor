!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.atracktor=e():t.atracktor=e()}(window,(function(){return function(t){var e={};function n(i){if(e[i])return e[i].exports;var o=e[i]={i:i,l:!1,exports:{}};return t[i].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)n.d(i,o,function(e){return t[e]}.bind(null,o));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=0)}([function(t,e,n){"use strict";n.r(e),n.d(e,"AbstractAnalyzer",(function(){return o})),n.d(e,"AmplitudeAnalyzer",(function(){return a})),n.d(e,"FrequencyAnalyzer",(function(){return u})),n.d(e,"WaveformAnalyzer",(function(){return h})),n.d(e,"WaveformGraph",(function(){return l}));var i,o=function(){function t(t,e,n){this.isAudioContextInitialized=!1,this.setAudioSource(t),this.setViewElement(e),this.setOption(n),this.initView()}return t.prototype.start=function(){this.initAudio(),this.initAnalyzer(),this.render()},t.prototype.pause=function(){cancelAnimationFrame(this.requestAniFrameID)},t.prototype.stop=function(){cancelAnimationFrame(this.requestAniFrameID),this.clear()},t.prototype.resize=function(){this.width=this.viewElement.offsetWidth||256,this.height=this.viewElement.offsetHeight||100,this.canvasElement.width=this.width,this.canvasElement.height=this.height},t.prototype.clear=function(){this.canvasContext.clearRect(0,0,this.width,this.height)},t.prototype.getAudioSource=function(){return{audioContext:this.audioContext,audioElement:this.audioElement,mediaSource:this.mediaSource}},t.prototype.getViewElement=function(){return this.viewElement},t.prototype.getDefaultFftSize=function(){return 256},t.prototype.getDefaultColor=function(){return"#fff"},t.prototype.getDefaultViewElement=function(){var t=document.createElement("div");return t.style.width="256px",t.style.height="100px",t.style.backgroundColor="#000",document.body.append(t),t},t.prototype.setOption=function(e){e=e||{},this.fftSize=e.fftSize||this.getDefaultFftSize(),this.color=t.normalizeColor(e.color||this.getDefaultColor()),this.sourceChannel=e.sourceChannel||0,this.connectDestination=void 0===e.connectDestination||e.connectDestination},t.prototype.setViewElement=function(t){this.viewElement=t||this.getDefaultViewElement()},t.prototype.setAudioSource=function(t){t&&(t instanceof HTMLMediaElement?this.audioElement=t:this.mediaSource=t),this.audioElement||(this.audioElement=document.createElement("audio"))},t.prototype.initView=function(){this.viewElement=this.viewElement||this.getDefaultViewElement(),this.canvasElement=document.createElement("canvas"),this.canvasContext=this.canvasElement.getContext("2d"),this.viewElement.append(this.canvasElement),this.resize(),this.clear()},t.prototype.initAudio=function(){if(!this.isAudioContextInitialized){if(this.mediaSource)this.audioContext=this.mediaSource.context;else{var e=t.createAudioSourceForElement(this.audioElement,this.connectDestination);this.audioContext=e.audioContext,this.mediaSource=e.mediaSource}this.createAnalyzer(),this.isAudioContextInitialized=!0}},t.prototype.createAnalyzer=function(){this.analyser=this.audioContext.createAnalyser(),this.mediaSource.connect(this.analyser,this.sourceChannel)},t.prototype.initAnalyzer=function(){this.analyser.fftSize=this.fftSize,this.bufferLength=this.analyser.frequencyBinCount,this.dataArray=new Uint8Array(this.bufferLength)},t.createAudioSourceForElement=function(e,n){var i=t.findAudioSourceByElement(e);if(!i){var o=new(window.AudioContext||window.webkitAudioContext),r=o.createMediaElementSource(e);n&&r.connect(o.destination),i={audioElement:e,audioContext:o,mediaSource:r},t.audioSources.push(i)}return i},t.findAudioSourceByElement=function(e){return t.audioSources.find((function(t){return t.audioElement===e}))},t.normalizeColor=function(t){return t.replace(/^#(\w)(\w)(\w)$/,"#$1$1$2$2$3$3")},t.audioSources=[],t}(),r=(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),a=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.render=function(){e.requestAniFrameID=requestAnimationFrame(e.render),e.clear(),e.stereo?(e.drawLevel(e.analyser,0,e.width/2-1,0,e.height),e.drawLevel(e.analyser2,e.width/2,e.width/2-1,0,e.height)):e.drawLevel(e.analyser,0,e.width,0,e.height),e.digitizeLevel(0,e.width,0,e.height)},e}return r(e,t),e.prototype.getDefaultFftSize=function(){return 2048},e.prototype.setOption=function(e){t.prototype.setOption.call(this,e),e=e||{},this.colorClip=e.colorClip||"#f00",this.colorWarn=e.colorWarn||"#ff0",this.colorNorm=e.colorNorm||"#0f0",this.valueClip=void 0===e.valueClip?.9:e.valueClip,this.valueWarn=void 0===e.valueWarn?.8:e.valueWarn,this.barSize=void 0===e.barSize?5:e.barSize,this.stereo=void 0===e.stereo||e.stereo,this.fillStyle=e.fillStyle},e.prototype.createAnalyzer=function(){if(this.analyser=this.audioContext.createAnalyser(),this.stereo){var t=this.audioContext.createChannelSplitter(2);this.mediaSource.connect(t),this.analyser2=this.audioContext.createAnalyser(),t.connect(this.analyser,0),t.connect(this.analyser2,1)}else this.mediaSource.connect(this.analyser,this.sourceChannel)},e.prototype.getStyle=function(){return this.fillStyle||(this.fillStyle=this.canvasContext.createLinearGradient(0,this.height,0,0),this.fillStyle.addColorStop(0,this.colorNorm),this.fillStyle.addColorStop(this.valueWarn,this.colorWarn),this.fillStyle.addColorStop(this.valueClip,this.colorClip)),this.fillStyle},e.prototype.digitizeLevel=function(t,e,n,i){for(var o=n+1;o<i;o++)this.canvasContext.clearRect(t,o*this.barSize,e,1)},e.prototype.drawLevel=function(t,e,n,i,o){t.getByteTimeDomainData(this.dataArray);var r=Math.max.apply(Math,Array.from(this.dataArray))/128*o;this.canvasContext.fillStyle=this.getStyle(),this.canvasContext.fillRect(e,o,n,o-r)},e}(o),s=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),u=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.render=function(){e.requestAniFrameID=requestAnimationFrame(e.render),e.analyser.getByteFrequencyData(e.dataArray),e.clear();for(var t=e.width/e.bufferLength,n=0,i=0;i<e.bufferLength;i++){var o=e.dataArray[i]/255*e.height,r=e.dataArray[i].toString(16);e.canvasContext.fillStyle=e.color+r,e.canvasContext.fillRect(n,e.height-o,t,e.height),n+=t+1}},e}return s(e,t),e.prototype.getDefaultColor=function(){return"#f33"},e}(o),c=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),h=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.render=function(){e.requestAniFrameID=requestAnimationFrame(e.render),e.analyser.getByteTimeDomainData(e.dataArray),e.clear(),e.canvasContext.lineWidth=1,e.canvasContext.strokeStyle=e.color,e.canvasContext.beginPath();for(var t=e.width/e.bufferLength,n=0,i=0;i<e.bufferLength;i++){var o=e.dataArray[i]/128*(e.height/2);0==i?e.canvasContext.moveTo(n,o):e.canvasContext.lineTo(n,o),n+=t}e.canvasContext.lineTo(e.width,e.height/2),e.canvasContext.stroke()},e}return c(e,t),e.prototype.getDefaultFftSize=function(){return 2048},e.prototype.getDefaultColor=function(){return"#fff"},e}(o),l=function(){function t(t,e,n){this.audioElement=t,this.viewElement=e,this.options=n,this.isAudioContextInitialized=!1,this.setOption(n),this.init()}return t.prototype.setOption=function(t){t=t||{},this.colorPositive=t.colorPositive||"#0f0",this.colorNegative=t.colorNegative||"#0a0",this.sourceChannel=t.sourceChannel},t.prototype.init=function(){this.canvasElement=document.createElement("canvas"),this.canvasContext=this.canvasElement.getContext("2d"),this.viewElement.append(this.canvasElement),this.setSize(),this.reset()},t.prototype.initAudio=function(){this.isAudioContextInitialized||(this.audioContext=new(window.AudioContext||window.webkitAudioContext),this.isAudioContextInitialized=!0)},t.prototype.reset=function(){this.canvasContext.clearRect(0,0,this.width,this.height)},t.prototype.resize=function(){this.setSize(),this.createWaveForm(this.decodedBuffer)},t.prototype.render=function(){var t=this;this.initAudio(),fetch(this.audioElement.src).then((function(t){return t.arrayBuffer()})).then((function(e){return t.audioContext.decodeAudioData(e)})).then((function(e){t.decodedBuffer=e,t.createWaveForm(e)}))},t.prototype.setSize=function(){this.width=this.viewElement.offsetWidth||256,this.height=this.viewElement.offsetHeight||100,this.canvasElement.width=this.width,this.canvasElement.height=this.height},t.prototype.filterData=function(t){for(var e=t.getChannelData(this.sourceChannel||0),n=void 0===this.sourceChannel&&t.numberOfChannels>1?t.getChannelData(1):void 0,i=this.width,o=Math.floor(e.length/i),r=[],a=0;a<i;a++){for(var s=o*a,u=0,c=0;c<o;c++){var h=Math.abs(e[s+c]);n&&(h=Math.max(h,Math.abs(n[s+c]))),u+=h}r.push(u/o)}return r},t.prototype.drawSegment=function(t,e,n,i){var o=i?e:-e;this.canvasContext.fillStyle=i?this.colorNegative:this.colorPositive,this.canvasContext.fillRect(t,this.height/2,n,o)},t.prototype.createWaveForm=function(t){this.reset();for(var e=this.filterData(t),n=this.height,i=this.width/e.length,o=0;o<e.length;o++){var r=i*o,a=e[o]*n;a<0?a=0:a>n&&(a=n),this.drawSegment(r,a,i,!!((o+1)%2))}},t}()}])}));